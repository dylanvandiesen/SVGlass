<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Metal Border Generator (CSS Paint API)</title>
  <style>
    :root {
      --border-size: 24;
      --radius: 28;
      --bevel: 0.65;
      --roughness: 0.25;
      --texture-scale: 1.2;
      --texture-strength: 0.35;
      --color1-r: 230; --color1-g: 235; --color1-b: 245; --color1-a: 0.95;
      --color2-r: 140; --color2-g: 150; --color2-b: 170; --color2-a: 0.9;
      --color3-r: 70; --color3-g: 78; --color3-b: 96; --color3-a: 0.88;
      --color4-r: 250; --color4-g: 252; --color4-b: 255; --color4-a: 0.5;
      --light-angle: 30;
      --light-elevation: 0.75;
      --light-intensity: 1;
      --scroll-drive: 1;
      --inner-shadow-x: 0;
      --inner-shadow-y: 2;
      --inner-shadow-blur: 16;
      --inner-shadow-spread: 2;
      --inner-shadow-r: 10; --inner-shadow-g: 12; --inner-shadow-b: 18; --inner-shadow-a: 0.6;
      --outer-shadow-x: 0;
      --outer-shadow-y: 8;
      --outer-shadow-blur: 24;
      --outer-shadow-r: 0; --outer-shadow-g: 0; --outer-shadow-b: 0; --outer-shadow-a: 0.45;
      --panel-bg-a: 0.22;
      --fill-a: 0.04;
      --mix-blend: normal;
      --filter-brightness: 1;
      --filter-contrast: 1.05;
      --filter-saturate: 1.12;
      --filter-hue: 0;
      --filter-sepia: 0;
      --filter-blur: 0;
    }

    @property --light-angle {
      syntax: "<number>";
      inherits: true;
      initial-value: 30;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: #eff4ff;
      background:
        radial-gradient(circle at 20% 10%, #3a4056 0%, #1b1d28 42%, #0f1118 100%);
      min-height: 250vh;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(280px, 380px) minmax(0, 1fr);
      gap: 1.2rem;
      padding: 1rem;
      align-items: start;
    }

    .controls {
      position: sticky;
      top: 0.5rem;
      max-height: calc(100vh - 1rem);
      overflow: auto;
      background: rgba(18, 21, 31, 0.82);
      backdrop-filter: blur(8px);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 0.9rem;
    }

    .controls h2 {
      margin: 0 0 0.3rem;
      font-size: 1.1rem;
    }

    .controls p {
      margin: 0 0 0.8rem;
      opacity: 0.8;
      font-size: 0.85rem;
    }

    .group {
      border-top: 1px solid rgba(255,255,255,0.12);
      padding-top: 0.7rem;
      margin-top: 0.7rem;
    }

    .group h3 {
      margin: 0 0 0.45rem;
      font-size: 0.88rem;
      opacity: 0.92;
      letter-spacing: 0.02em;
    }

    label {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.8rem;
      margin-bottom: 0.45rem;
    }

    input[type="range"], select, input[type="color"] {
      width: 100%;
      margin-top: 0.2rem;
    }

    input[type="color"] {
      height: 38px;
      border: none;
      border-radius: 8px;
      background: transparent;
      padding: 0;
    }

    .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }

    .stage {
      display: grid;
      place-items: center;
      min-height: 92vh;
      padding: 1.2rem;
    }

    .card-wrap {
      position: relative;
      width: min(92vw, 820px);
      min-height: min(58vh, 480px);
      border-radius: calc(var(--radius) * 1px);
      isolation: isolate;
      filter:
        brightness(var(--filter-brightness))
        contrast(var(--filter-contrast))
        saturate(var(--filter-saturate))
        hue-rotate(calc(var(--filter-hue) * 1deg))
        sepia(var(--filter-sepia))
        blur(calc(var(--filter-blur) * 1px));
    }

    .card-wrap::before,
    .card-wrap::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
    }

    .card-wrap::before {
      background: paint(metal-border);
      mix-blend-mode: var(--mix-blend);
      box-shadow:
        calc(var(--outer-shadow-x) * 1px) calc(var(--outer-shadow-y) * 1px) calc(var(--outer-shadow-blur) * 1px)
        rgba(var(--outer-shadow-r), var(--outer-shadow-g), var(--outer-shadow-b), var(--outer-shadow-a));
    }

    .card-wrap::after {
      inset: calc(var(--border-size) * 1px);
      border-radius: calc((var(--radius) - var(--border-size) * 0.5) * 1px);
      box-shadow:
        inset calc(var(--inner-shadow-x) * 1px) calc(var(--inner-shadow-y) * 1px) calc(var(--inner-shadow-blur) * 1px)
        calc(var(--inner-shadow-spread) * 1px)
        rgba(var(--inner-shadow-r), var(--inner-shadow-g), var(--inner-shadow-b), var(--inner-shadow-a));
      background: rgba(255, 255, 255, var(--fill-a));
    }

    .content {
      position: absolute;
      inset: calc(var(--border-size) * 1px);
      border-radius: calc((var(--radius) - var(--border-size) * 0.5) * 1px);
      display: grid;
      place-items: center;
      text-align: center;
      padding: 1.2rem;
      background: transparent;
    }

    .content h1 { margin: 0; font-size: clamp(1.4rem, 3vw, 2.4rem); }
    .content p { max-width: 40ch; opacity: 0.87; }

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
      .controls {
        position: fixed;
        top: auto;
        bottom: 0;
        left: 0.6rem;
        right: 0.6rem;
        max-height: 42vh;
        z-index: 10;
      }
      .stage { padding-bottom: 44vh; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="controls" id="controls">
      <h2>Metal Border Generator</h2>
      <p>Scroll page to animate light. Touch-friendly controls below.</p>

      <div class="group">
        <h3>Geometry + Light</h3>
        <label>Border size <output data-out="--border-size"></output><input data-var="--border-size" type="range" min="4" max="64" step="1" value="24"></label>
        <label>Radius <output data-out="--radius"></output><input data-var="--radius" type="range" min="0" max="80" step="1" value="28"></label>
        <label>Bevel <output data-out="--bevel"></output><input data-var="--bevel" type="range" min="0" max="1" step="0.01" value="0.65"></label>
        <label>Light angle <output data-out="--light-angle"></output><input data-var="--light-angle" type="range" min="0" max="360" step="1" value="30"></label>
        <label>Light elevation <output data-out="--light-elevation"></output><input data-var="--light-elevation" type="range" min="0" max="1" step="0.01" value="0.75"></label>
        <label>Light intensity <output data-out="--light-intensity"></output><input data-var="--light-intensity" type="range" min="0" max="2" step="0.01" value="1"></label>
        <label>Scroll drive <output data-out="--scroll-drive"></output><input data-var="--scroll-drive" type="range" min="0" max="2" step="0.01" value="1"></label>
      </div>

      <div class="group">
        <h3>Texture + Blend</h3>
        <label>Roughness <output data-out="--roughness"></output><input data-var="--roughness" type="range" min="0" max="1" step="0.01" value="0.25"></label>
        <label>Texture scale <output data-out="--texture-scale"></output><input data-var="--texture-scale" type="range" min="0.4" max="8" step="0.01" value="1.2"></label>
        <label>Texture strength <output data-out="--texture-strength"></output><input data-var="--texture-strength" type="range" min="0" max="1" step="0.01" value="0.35"></label>
        <label>Blend mode
          <select data-var="--mix-blend">
            <option>normal</option><option>overlay</option><option>screen</option><option>multiply</option>
            <option>soft-light</option><option>hard-light</option><option>luminosity</option><option>difference</option>
          </select>
        </label>
      </div>

      <div class="group"><h3>Colors (+ alpha per stop)</h3><div id="color-controls"></div></div>

      <div class="group">
        <h3>Shadows + Filters</h3>
        <label>Outer shadow color <input type="color" id="outer-shadow-color" value="#000000"></label>
        <label>Outer blur <output data-out="--outer-shadow-blur"></output><input data-var="--outer-shadow-blur" type="range" min="0" max="80" step="1" value="24"></label>
        <label>Outer alpha <output data-out="--outer-shadow-a"></output><input data-var="--outer-shadow-a" type="range" min="0" max="1" step="0.01" value="0.45"></label>
        <label>Inner shadow color <input type="color" id="inner-shadow-color" value="#0a0c12"></label>
        <label>Inner blur <output data-out="--inner-shadow-blur"></output><input data-var="--inner-shadow-blur" type="range" min="0" max="50" step="1" value="16"></label>
        <label>Inner alpha <output data-out="--inner-shadow-a"></output><input data-var="--inner-shadow-a" type="range" min="0" max="1" step="0.01" value="0.6"></label>
        <label>Brightness <output data-out="--filter-brightness"></output><input data-var="--filter-brightness" type="range" min="0.4" max="2" step="0.01" value="1"></label>
        <label>Contrast <output data-out="--filter-contrast"></output><input data-var="--filter-contrast" type="range" min="0.5" max="2.5" step="0.01" value="1.05"></label>
        <label>Saturate <output data-out="--filter-saturate"></output><input data-var="--filter-saturate" type="range" min="0" max="3" step="0.01" value="1.12"></label>
        <label>Hue rotate <output data-out="--filter-hue"></output><input data-var="--filter-hue" type="range" min="0" max="360" step="1" value="0"></label>
        <label>Sepia <output data-out="--filter-sepia"></output><input data-var="--filter-sepia" type="range" min="0" max="1" step="0.01" value="0"></label>
        <label>Blur <output data-out="--filter-blur"></output><input data-var="--filter-blur" type="range" min="0" max="5" step="0.1" value="0"></label>
      </div>
    </aside>

    <main class="stage">
      <div class="card-wrap" id="card">
        <div class="content">
          <div>
            <h1>CSS Paint Metal Border</h1>
            <p>Transparent center, inner and outer border shadows, conic-inspired metal lighting, texturing, blend modes, and scroll-driven light movement.</p>
          </div>
        </div>
      </div>
    </main>
  </div>

<script>
const WORKLET = `
class MetalBorderPainter {
  static get inputProperties() {
    return [
      '--border-size','--radius','--bevel','--roughness','--texture-scale','--texture-strength',
      '--light-angle','--light-elevation','--light-intensity',
      '--color1-r','--color1-g','--color1-b','--color1-a',
      '--color2-r','--color2-g','--color2-b','--color2-a',
      '--color3-r','--color3-g','--color3-b','--color3-a',
      '--color4-r','--color4-g','--color4-b','--color4-a'
    ];
  }

  p(props, n, d=0){ const v = parseFloat((props.get(n)||'').toString()); return Number.isFinite(v) ? v : d; }
  rgba(props,i){
    return [this.p(props,'--color' + i + '-r',255),this.p(props,'--color' + i + '-g',255),this.p(props,'--color' + i + '-b',255),this.p(props,'--color' + i + '-a',1)];
  }
  lerp(a,b,t){ return a + (b-a)*t; }
  mix(c1,c2,t){ return [this.lerp(c1[0],c2[0],t),this.lerp(c1[1],c2[1],t),this.lerp(c1[2],c2[2],t),this.lerp(c1[3],c2[3],t)]; }
  hash(x,y){ return (Math.sin(x*127.1+y*311.7)*43758.5453123)%1; }

  paint(ctx, size, props) {
    const w = size.width, h = size.height;
    const border = Math.max(1, this.p(props,'--border-size',20));
    const radius = Math.max(0, this.p(props,'--radius',18));
    const bevel = this.p(props,'--bevel',0.6);
    const rough = this.p(props,'--roughness',0.2);
    const texScale = Math.max(0.001, this.p(props,'--texture-scale',1));
    const texStrength = this.p(props,'--texture-strength',0.3);
    const angle = this.p(props,'--light-angle',35) * (Math.PI/180);
    const elev = this.p(props,'--light-elevation',0.7);
    const intensity = this.p(props,'--light-intensity',1);

    const c1=this.rgba(props,1), c2=this.rgba(props,2), c3=this.rgba(props,3), c4=this.rgba(props,4);

    ctx.clearRect(0,0,w,h);
    const outer = new Path2D();
    outer.roundRect(0,0,w,h,radius);
    const inner = new Path2D();
    inner.roundRect(border,border,Math.max(0,w-2*border),Math.max(0,h-2*border),Math.max(0,radius-border*0.45));

    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0)';
    ctx.fill(outer);
    ctx.globalCompositeOperation = 'source-over';
    ctx.clip(outer);
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fill(inner);
    ctx.globalCompositeOperation = 'source-over';

    const grad = ctx.createConicGradient(angle, w*0.5, h*0.5);
    grad.addColorStop(0.00, 'rgba(' + c1[0] + ',' + c1[1] + ',' + c1[2] + ',' + c1[3] + ')');
    grad.addColorStop(0.22, 'rgba(' + c2[0] + ',' + c2[1] + ',' + c2[2] + ',' + c2[3] + ')');
    grad.addColorStop(0.58, 'rgba(' + c3[0] + ',' + c3[1] + ',' + c3[2] + ',' + c3[3] + ')');
    grad.addColorStop(1.00, 'rgba(' + c4[0] + ',' + c4[1] + ',' + c4[2] + ',' + c4[3] + ')');
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,w,h);

    const steps = Math.max(28, Math.floor(border*1.5));
    for (let i=0;i<steps;i++) {
      const t = i/(steps-1);
      const towardLight = Math.cos((t*2*Math.PI)-angle) * 0.5 + 0.5;
      const hi = Math.pow(towardLight, 2.2) * bevel * intensity * (0.8 + elev*0.4);
      const lo = (1-towardLight) * bevel * 0.25;
      const alpha = Math.max(0, hi-lo) * 0.16;
      ctx.strokeStyle = 'rgba(255,255,255,' + alpha + ')';
      ctx.lineWidth = 1;
      const off = i + 0.5;
      ctx.beginPath();
      ctx.roundRect(off,off,w-off*2,h-off*2,Math.max(0,radius-off*0.8));
      ctx.stroke();
    }

    const cell = Math.max(1, Math.floor(3/texScale));
    for (let y=0;y<h;y+=cell) {
      for (let x=0;x<w;x+=cell) {
        const n = this.hash(x*0.031*texScale,y*0.031*texScale);
        const dir = Math.abs(Math.sin((x+y)*0.002*texScale+angle));
        const a = (n*0.6 + dir*0.4) * texStrength * (0.08 + rough*0.18);
        if (a < 0.006) continue;
        ctx.fillStyle = 'rgba(255,255,255,' + a + ')';
        ctx.fillRect(x,y,cell,cell);
      }
    }

    ctx.restore();
  }
}
registerPaint('metal-border', MetalBorderPainter);
`;

(async () => {
  if ('paintWorklet' in CSS) {
    const blob = new Blob([WORKLET], {type: 'text/javascript'});
    await CSS.paintWorklet.addModule(URL.createObjectURL(blob));
  } else {
    alert('Paint API is unavailable in this browser. Demo will not render as intended.');
  }
})();

const root = document.documentElement;
const controls = document.querySelectorAll('[data-var]');
const outputs = document.querySelectorAll('[data-out]');
let manualLightAngle = 30;

function setVar(name, value){ root.style.setProperty(name, value); }
function initOutputs(){
  outputs.forEach(out=>{
    const key = out.dataset.out;
    out.textContent = getComputedStyle(root).getPropertyValue(key).trim();
  });
}

controls.forEach(el => {
  const key = el.dataset.var;
  const update = () => {
    if (key === '--light-angle') manualLightAngle = parseFloat(el.value) || 0;
    setVar(key, el.value);
    const out = document.querySelector(`[data-out="${key}"]`);
    if (out) out.textContent = el.value;
  };
  el.addEventListener('input', update, {passive:true});
  update();
});

function hexToRgb(hex){
  const clean = hex.replace('#','');
  const val = parseInt(clean,16);
  return {r:(val>>16)&255, g:(val>>8)&255, b:val&255};
}

const colorHost = document.getElementById('color-controls');
for (let i=1;i<=4;i++) {
  const wrap = document.createElement('div');
  wrap.className = 'row2';
  wrap.innerHTML = `
    <label>Color ${i}<input type="color" data-color="${i}" value="#${['e6ebf5','8c96aa','464e60','fafcff'][i-1]}"></label>
    <label>Alpha ${i}<input type="range" data-alpha="${i}" min="0" max="1" step="0.01" value="${[0.95,0.9,0.88,0.5][i-1]}"></label>
  `;
  colorHost.appendChild(wrap);
}

colorHost.addEventListener('input', (e) => {
  const t = e.target;
  if (t.matches('[data-color]')) {
    const i = t.dataset.color;
    const {r,g,b} = hexToRgb(t.value);
    setVar(`--color${i}-r`, r); setVar(`--color${i}-g`, g); setVar(`--color${i}-b`, b);
  }
  if (t.matches('[data-alpha]')) setVar(`--color${t.dataset.alpha}-a`, t.value);
});

for (const el of colorHost.querySelectorAll('[data-color],[data-alpha]')) el.dispatchEvent(new Event('input'));

const outerShadowColor = document.getElementById('outer-shadow-color');
const innerShadowColor = document.getElementById('inner-shadow-color');

function applyShadowColor(input, prefix){
  const {r,g,b} = hexToRgb(input.value);
  setVar(`--${prefix}-r`, r);
  setVar(`--${prefix}-g`, g);
  setVar(`--${prefix}-b`, b);
}
outerShadowColor.addEventListener('input', () => applyShadowColor(outerShadowColor, 'outer-shadow'));
innerShadowColor.addEventListener('input', () => applyShadowColor(innerShadowColor, 'inner-shadow'));
applyShadowColor(outerShadowColor, 'outer-shadow');
applyShadowColor(innerShadowColor, 'inner-shadow');

let ticking = false;
function onScroll(){
  if (ticking) return;
  ticking = true;
  requestAnimationFrame(() => {
    const max = document.documentElement.scrollHeight - innerHeight;
    const progress = max > 0 ? scrollY / max : 0;
    const drive = parseFloat(getComputedStyle(root).getPropertyValue('--scroll-drive')) || 1;
    const base = manualLightAngle;
    setVar('--light-angle', ((base + progress*360*drive)%360).toFixed(2));
    const out = document.querySelector('[data-out="--light-angle"]');
    if (out) out.textContent = getComputedStyle(root).getPropertyValue('--light-angle').trim();
    ticking = false;
  });
}
addEventListener('scroll', onScroll, {passive:true});
initOutputs();
</script>
</body>
</html>
